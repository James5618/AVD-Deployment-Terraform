# ============================================================================
# Development Environment - Configuration Example
# ============================================================================
# Copy this file to terraform.tfvars and customize the values below.
# 
# IMPORTANT: Never commit terraform.tfvars to version control!
# Add terraform.tfvars to .gitignore to protect sensitive data.
#
# For production, use Azure Key Vault for secrets (see bottom of file).
# ============================================================================

# ╔═══════════════════════════════════════════════════════════════════════════╗
# ║ MOST COMMONLY EDITED SETTINGS - START HERE                                ║
# ╚═══════════════════════════════════════════════════════════════════════════╝

# ─────────────────────────────────────────────────────────────────────────────
# KEY VAULT - Secure password storage (RECOMMENDED)
# ─────────────────────────────────────────────────────────────────────────────
# RECOMMENDED: Use Azure Key Vault to eliminate plaintext passwords
# Key Vault auto-generates secure 24-character passwords and stores them securely.
# Cost: ~$1-5/month (minimal - mostly secret operations)
enable_key_vault           = true    # Enable Key Vault (HIGHLY RECOMMENDED)
key_vault_name             = ""      # Leave empty to auto-generate: avd-dev-kv-abc123
auto_generate_passwords    = true    # Auto-generate passwords (RECOMMENDED)
key_vault_purge_protection = false   # Prevent permanent deletion (set to true for production)

# FALLBACK: If enable_key_vault = false, you MUST provide passwords below
# This is NOT recommended - passwords will be in plaintext in this file!
# domain_admin_password                 = "P@ssw0rd123!ChangeMe"
# session_host_local_admin_password     = "P@ssw0rd123!ChangeMe"

# ─────────────────────────────────────────────────────────────────────────────
# BASICS - Project identification and location
# ─────────────────────────────────────────────────────────────────────────────
environment    = "dev"
location       = "eastus"          # Azure region: eastus, westeurope, centralus, etc.
location_short = "eus"             # Short code for naming
project_name   = "avd"             # Used in resource names: avd-dev-rg, avd-dev-vnet, etc.

# ─────────────────────────────────────────────────────────────────────────────
# CREDENTIALS - ONLY NEEDED IF enable_key_vault = false (NOT RECOMMENDED)
# ─────────────────────────────────────────────────────────────────────────────
# WARNING: If Key Vault is disabled, you must provide passwords here.
# Passwords will be stored in PLAINTEXT in terraform.tfvars (security risk!).
# 
# RECOMMENDED APPROACH: Keep enable_key_vault = true and let Key Vault
# auto-generate and securely store passwords. You'll never see or manage them!
# 
# ONLY uncomment these lines if enable_key_vault = false:
# domain_admin_username = "domainadmin"
# domain_admin_password = "P@ssw0rd123!ChangeMe"  # CHANGE THIS!
# session_host_local_admin_username = "localadmin"
# session_host_local_admin_password = "P@ssw0rd123!ChangeMe"  # CHANGE THIS!
# 
# If Key Vault is enabled (default), these variables are ignored and passwords
# are auto-generated and stored in Key Vault.

# ─────────────────────────────────────────────────────────────────────────────
# SESSION HOST IMAGE STRATEGY - Choose ONE approach
# ─────────────────────────────────────────────────────────────────────────────
# Unified image selection for session hosts. Choose the strategy that fits your needs:
#
# 1. marketplace (DEFAULT)
#    - Uses Azure Marketplace images (Windows 11 Multi-Session + M365)
#    - No additional configuration required
#    - Always up-to-date with latest Windows patches
#    - Best for: Quick deployments, standard configurations
#
# 2. aib_gallery
#    - Uses Azure Image Builder to create custom images
#    - Automated build process with scripts and packages
#    - Requires: enable_golden_image = true
#    - Best for: Repeatable builds, CI/CD pipelines
#
# 3. manual_gallery
#    - Uses manually prepared and imported images
#    - Full control over customization process
#    - Requires: enable_manual_gallery_import = true + source image details
#    - Best for: Complex configurations, migration scenarios
#
session_host_image_strategy = "manual_gallery"  # Options: marketplace, aib_gallery, manual_gallery

# ─────────────────────────────────────────────────────────────────────────────
# IMAGE IMPORT - Import Manually Prepared Images to Azure Compute Gallery
# ─────────────────────────────────────────────────────────────────────────────
# REQUIRED when session_host_image_strategy = "manual_gallery"
# NEW SIMPLIFIED WORKFLOW: Import custom images you've manually created.
# All image configuration is centralized in main.tf > image_config locals block.
#
# Use this to import images for:
# - Migrating existing customized VMs to AVD
# - Complex configurations that can't be automated with scripts
# - Testing custom configurations before automating
# 
# WORKFLOW:
# 1. Create VM, install apps, customize settings
# 2. Run sysprep: C:\Windows\System32\Sysprep\sysprep.exe /generalize /oobe /shutdown
# 3. Capture to Managed Image (RECOMMENDED) or export to VHD
# 4. Configure variables below
# 5. Run: terraform apply -target=module.manual_gallery_import
# 6. Session hosts automatically use the new gallery image version
#
# See README.md \"Manual Golden Image Creation\" section for detailed steps.
# ─────────────────────────────────────────────────────────────────────────────

enable_manual_gallery_import = false  # Enable manual gallery image import (set to true to activate)

# Image Source - Choose ONE:
image_source_type = "managed_image"  # "managed_image" (recommended) or "vhd"

# Option A: Managed Image (RECOMMENDED - faster, simpler)
# Get ID: az image show --resource-group rg-images --name img-win11-custom --query id -o tsv
source_managed_image_id = null
# Example: "/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/rg-images/providers/Microsoft.Compute/images/win11-custom"

# Option B: VHD in Blob Storage (for cross-tenant or archived images)
source_vhd_uri = null
# Example: "https://mystorageacct.blob.core.windows.net/vhds/win11-custom.vhd"

# Image Versioning - Increment for each new capture
image_version = "1.0.0"  # Format: MAJOR.MINOR.PATCH (e.g., 1.0.0, 1.1.0, 2.0.0)

# Version Pinning (PRODUCTION BEST PRACTICE)
pin_image_version_id = true  # true = pin to specific version (RECOMMENDED for prod), false = float to 'latest'

# Image Replication
image_replication_regions = []  # Default: current location only. Example: ["eastus", "westus2", "westeurope"]
exclude_from_latest       = true  # true = exclude from 'latest' queries (RECOMMENDED for prod)

# Gallery Configuration
gallery_name    = ""  # Leave empty to auto-generate: avd_dev_gallery
gallery_rg_name = ""  # Leave empty to create gallery in main resource group

# Image Definition Metadata
image_definition_name = "windows11-avd-custom"  # Image definition name in gallery
image_publisher       = "MyCompany"             # Your organization name
image_offer           = "Windows11-AVD-Custom"  # Offer name
image_sku             = "custom"                # SKU identifier
hyper_v_generation    = "V2"                    # V2 (UEFI, required for Win11) or V1 (legacy BIOS)
os_type               = "Windows"               # Windows or Linux

# Cost: ~$5-10/month for image storage in Azure Compute Gallery
# Deployment time: 10-30 minutes depending on source type

# ─────────────────────────────────────────────────────────────────────────────
# GOLDEN IMAGE - Custom AVD image with Azure Image Builder (OPTIONAL)
# ─────────────────────────────────────────────────────────────────────────────
# ✅ RECOMMENDED FOR PRODUCTION: Build custom golden images for faster deployments
# Golden images include:
# - Latest Windows updates
# - Pre-installed applications (Chrome, 7zip, Teams, etc.)
# - Custom configurations and registry settings
# 
# Benefits:
# - Session host deployment time: 5-10 min (vs 30-60 min with marketplace images)
# - Consistent configuration across all session hosts
# - Reduced post-deployment scripting
# 
# Cost: ~$1-3 per build + $5-15/month storage
# Build time: 30-90 minutes (manual trigger required after terraform apply)
# 
enable_golden_image                    = false  # Enable golden image builder (disabled by default)
golden_image_version                   = "1.0.0"  # Increment for each new build: 1.0.0, 1.1.0, 2.0.0
golden_image_base_sku                  = "win11-22h2-avd-m365"  # Base image: Windows 11 + M365 Apps
golden_image_install_windows_updates   = true    # Install Windows updates (adds 15-30 min to build)
golden_image_chocolatey_packages       = []      # Example: ["googlechrome", "7zip", "adobereader"]
golden_image_custom_scripts            = {}      # Custom PowerShell scripts (see README)
golden_image_replication_regions       = []      # Example: ["eastus", "westus2"] (replicate to multiple regions)

# After terraform apply, manually trigger build:
#   az image builder run --resource-group avd-dev-rg --name avd-dev-golden-template
# See modules/golden_image/README.md for detailed instructions

# ─────────────────────────────────────────────────────────────────────────────
# MANUAL IMAGE IMPORT (LEGACY) - Import manually prepared images
# ─────────────────────────────────────────────────────────────────────────────
# LEGACY: This section maintained for backward compatibility.
# New deployments should use the IMAGE IMPORT section above for simplified workflow.
#
# Use this to import custom images you've manually created, generalized (sysprep),
# and captured. Best for:
# - Migrating existing customized VMs to AVD
# - Complex configurations that can't be automated with scripts
# - One-time imports before switching to automated Golden Image pipeline
# 
# Prerequisites:
# 1. Create and customize a Windows VM in Azure
# 2. Run sysprep: C:\Windows\System32\Sysprep\sysprep.exe /generalize /oobe /shutdown
# 3. Capture to either:
#    - Managed Image: az image create --source /subscriptions/.../virtualMachines/...
#    - VHD: Export OS disk to storage account
# 
# See modules/manual_gallery_import/README.md for detailed sysprep and capture instructions.
# 
manual_image_source_type       = "managed_image"  # "managed_image" or "vhd"

# Option 1: Import from Managed Image (RECOMMENDED)
manual_image_managed_image_id  = null  # Example: "/subscriptions/12345.../resourceGroups/rg-images/providers/Microsoft.Compute/images/win11-custom"

# Option 2: Import from VHD
manual_image_vhd_uri           = null  # Example: "https://mystorageacct.blob.core.windows.net/vhds/win11-custom.vhd"

# Image Configuration
manual_image_version           = "1.0.0"  # Semantic version (increment for updates: 1.0.0, 1.1.0, 2.0.0)
manual_image_definition_name   = "windows11-avd-manual"  # Image definition name
manual_image_publisher         = "MyCompany"  # Your organization name
manual_image_offer             = "Windows-AVD-Manual"  # Offer name
manual_image_sku               = "manual-v1"  # SKU identifier
manual_image_hyper_v_generation = "V2"  # V1 or V2 (must match source VM)

# Cost: ~$5-10/month for image storage in Azure Compute Gallery

# ─────────────────────────────────────────────────────────────────────────────
# SCALING PLAN - Auto-scaling for cost optimization (60-80% savings)
# ─────────────────────────────────────────────────────────────────────────────
# RECOMMENDED FOR PRODUCTION: Enable auto-scaling to deallocate idle session hosts
# 
# How it works:
# - Ramp-up (7-9 AM): Gradually start hosts before users arrive
# - Peak (9 AM-5 PM): Maintain full capacity for business hours
# - Ramp-down (5-7 PM): Consolidate users to fewer hosts
# - Off-peak (7 PM-7 AM): Deallocate idle hosts (minimal capacity)
# 
# Benefits:
# - Cost savings: 60-80% reduction in VM costs (example: $276/mo → $110/mo)
# - Automatic: No manual intervention required
# - User-friendly: Optional notifications before forced logoff
# 
# Prerequisites:
# - Host pool must be "Pooled" type (not "Personal")
# - Recommended: Enable "Start VM on Connect" in host pool for seamless off-peak access
# 
enable_scaling_plan = false  # Enable auto-scaling (disabled by default)

# Timezone for schedule (Windows timezone format)
# Common values: 
# - "GMT Standard Time" (UK/Ireland, UTC+0)
# - "Central Europe Standard Time" (Paris/Berlin, UTC+1)
# - "Eastern Standard Time" (US East Coast, UTC-5)
# - "Pacific Standard Time" (US West Coast, UTC-8)
scaling_plan_timezone = "GMT Standard Time"  # Europe/London

# Weekday schedule times (24-hour format HH:MM)
# Adjust based on your business hours
weekday_ramp_up_start_time   = "07:00"  # Start scaling up (7 AM)
weekday_peak_start_time      = "09:00"  # Business hours begin (9 AM)
weekday_ramp_down_start_time = "17:00"  # Business hours end (5 PM)
weekday_off_peak_start_time  = "19:00"  # Minimal capacity (7 PM)

# Capacity settings (percentage of total host pool)
weekday_ramp_up_min_hosts_percent    = 20  # Keep at least 20% online during ramp-up
weekday_ramp_up_capacity_threshold   = 60  # Scale when >60% capacity used
weekday_ramp_down_min_hosts_percent  = 10  # Keep at least 10% online for late workers
weekday_ramp_down_capacity_threshold = 90  # Scale down when <90% capacity used

# User session management during ramp-down
# IMPORTANT: Test these settings thoroughly before enabling force logoff
scaling_force_logoff_users      = false  # false = wait indefinitely (recommended), true = force logoff after timeout
scaling_wait_time_minutes       = 30     # Minutes to wait before forcing logoff (if enabled)
scaling_notification_message    = "You will be logged off in 30 minutes. Please save your work."  # Message to users

# Cost savings example (4 VMs @ $0.096/hour):
# - Without scaling: $276/month (24 hours × 30 days)
# - With scaling: $110/month (14 off-peak hours/day deallocated)
# - Savings: $166/month (60% reduction)

# ─────────────────────────────────────────────────────────────────────────────
# CONDITIONAL ACCESS - Entra ID Security Policies (OPTIONAL)
# ─────────────────────────────────────────────────────────────────────────────
# REQUIRES: Entra ID Premium P1 or P2 licensing ($6-9/user/month)
# CRITICAL: Create break-glass accounts BEFORE enabling policies!
#
# What is Conditional Access?
# Conditional Access is Microsoft Entra ID's policy engine that evaluates 
# signals (user, location, device, app) and enforces access controls (block, 
# require MFA, require compliant device). For AVD, this provides defense-in-
# depth security.
#
# Security policies:
# - Multi-factor authentication (MFA) enforcement
# - Compliant or Hybrid Azure AD joined device requirement
# - Legacy authentication blocking (IMAP, POP3, SMTP, Exchange ActiveSync)
# - Approved client app requirement for mobile access
# - Session controls (sign-in frequency, persistent browser management)
#
# Deployment process (CRITICAL - follow this order):
#
# STEP 1: Create break-glass accounts (BEFORE enabling policies!)
#   Break-glass accounts are emergency access accounts that bypass all 
#   Conditional Access policies. Without them, misconfigured policies can 
#   lock out ALL users including Global Admins.
#
#   How to create:
#   1. Create 2 dedicated admin accounts:
#      az ad user create \
#        --display-name "Break Glass Admin 1" \
#        --user-principal-name breakglass1@yourdomain.com \
#        --password "SuperSecurePassword123!" \
#        --force-change-password-next-sign-in false
#
#      az ad user create \
#        --display-name "Break Glass Admin 2" \
#        --user-principal-name breakglass2@yourdomain.com \
#        --password "SuperSecurePassword123!" \
#        --force-change-password-next-sign-in false
#
#   2. Assign Global Administrator role:
#      az role assignment create \
#        --assignee breakglass1@yourdomain.com \
#        --role "Global Administrator"
#
#      az role assignment create \
#        --assignee breakglass2@yourdomain.com \
#        --role "Global Administrator"
#
#   3. Create Entra ID group for break-glass accounts:
#      az ad group create \
#        --display-name "Break-Glass Accounts" \
#        --mail-nickname "BreakGlass" \
#        --description "Emergency access accounts excluded from CA policies"
#
#   4. Add break-glass users to group:
#      GROUP_ID=$(az ad group show --group "Break-Glass Accounts" --query id -o tsv)
#      USER_ID=$(az ad user show --id breakglass1@yourdomain.com --query id -o tsv)
#      az ad group member add --group $GROUP_ID --member-id $USER_ID
#      
#      USER_ID=$(az ad user show --id breakglass2@yourdomain.com --query id -o tsv)
#      az ad group member add --group $GROUP_ID --member-id $USER_ID
#
#   5. Store passwords securely (offline):
#      - Physical safe or sealed envelope
#      - Split password across multiple executives
#      - Azure Key Vault with restricted access
#      NEVER store in password managers like LastPass/1Password
#
#   6. Test break-glass accounts monthly:
#      - Sign in to verify access
#      - Verify Global Admin permissions
#      - Document test results
#
# STEP 2: Create AVD users group
#   az ad group create \
#     --display-name "AVD Users" \
#     --mail-nickname "AVDUsers" \
#     --description "Users with access to Azure Virtual Desktop"
#
#   # Add users to group
#   az ad group member add --group "AVD Users" --member-id <user-object-id>
#
# STEP 3: Get group object IDs
#   az ad group show --group "AVD Users" --query id -o tsv
#   az ad group show --group "Break-Glass Accounts" --query id -o tsv
#
# STEP 4: Configure policies in report-only mode (2-4 weeks testing)
#   enable_conditional_access   = true
#   ca_mfa_policy_state         = "enabledForReportingButNotEnforced"
#   ca_device_policy_state      = "enabledForReportingButNotEnforced"
#   ca_legacy_auth_policy_state = "enabledForReportingButNotEnforced"
#
#   Deploy and monitor sign-in logs:
#   - Entra ID → Monitoring → Sign-in logs
#   - Filter by application: Azure Virtual Desktop
#   - Review Conditional Access tab for policy evaluations
#   - Adjust exclusions as needed
#
# STEP 5: Enable policies gradually
#   a) Start with legacy auth blocking (safe to enable immediately)
#   b) Enable MFA for pilot group (1-2 weeks)
#   c) Enable MFA for all users
#   d) Enable device compliance (if Intune configured)
#
# ─────────────────────────────────────────────────────────────────────────────

# Master toggle (IMPORTANT: Set to false until break-glass accounts created)
enable_conditional_access = false  # Enable ONLY after break-glass setup complete

# Policy toggles (which policies to deploy)
ca_require_mfa              = true   # Require MFA for AVD access (recommended)
ca_require_compliant_device = false  # Require compliant/hybrid device (requires Intune)
ca_block_legacy_auth        = true   # Block legacy protocols (IMAP, POP3, SMTP) (recommended)

# Targeting - Entra ID group object IDs
# 
# PRIMARY GROUP: Automatically wired from avd_core module (no config needed!)
#    The same group used for AVD app access (user_group_object_id) is automatically
#    targeted by Conditional Access policies. This ensures consistent access control.
#
# ADDITIONAL GROUPS (OPTIONAL): Use for pilot rollouts or special cases
#    Example: Create "AVD Pilot Users" group for gradual MFA rollout
ca_additional_target_group_ids = [
  # "87654321-4321-4321-4321-210987654321"  # Optional: AVD Pilot Users group
  # "11111111-2222-3333-4444-555555555555"  # Optional: AVD Power Users group
]

ca_break_glass_group_ids = [
  # "87654321-4321-4321-4321-210987654321"  # Replace with your Break-Glass Accounts group ID
]

# Policy states (enforcement level)
# Options:
#   "enabled"                            - Enforced (blocks non-compliant users)
#   "enabledForReportingButNotEnforced"  - Audit mode (logs only, no blocking)
#   "disabled"                           - Policy inactive
#
# SAFETY REQUIREMENT: ALL policies default to report-only mode
# RECOMMENDATION: Monitor in report-only for 2-4 weeks before enabling enforcement
# STAGED ROLLOUT: Legacy auth (week 3) -> MFA pilot (week 5) -> MFA all users (week 7)
ca_mfa_policy_state         = "enabledForReportingButNotEnforced"  # Report-only (REQUIRED initially)
ca_device_policy_state      = "enabledForReportingButNotEnforced"  # Report-only (REQUIRED initially)
ca_legacy_auth_policy_state = "enabledForReportingButNotEnforced"  # Report-only (start here, can enable at week 3)

# Emergency rollback procedures:
# 1. Admin locked out:
#    - Sign in with break-glass account
#    - Navigate: Entra ID → Security → Conditional Access
#    - Disable problematic policy or add user to break-glass group
#
# 2. Temporary exclusion:
#    - Add user to break-glass group (bypasses ALL policies)
#    - Use sparingly, document reason
#
# 3. Change to report-only:
#    - Set policy state to "enabledForReportingButNotEnforced"
#    - Monitor without blocking users
#
# 4. Complete disable:
#    - Set enable_conditional_access = false
#    - Run: terraform apply -auto-approve
#
# See modules/conditional_access/README.md for comprehensive documentation:
# - Sign-in log validation procedures (Entra portal, Azure CLI, Log Analytics)
# - Detailed rollback procedures (emergency, temporary, permanent)
# - Break-glass account management
# - Testing procedures
# - Troubleshooting common issues

# ─────────────────────────────────────────────────────────────────────────────
# DOMAIN CONFIGURATION - Active Directory Domain Services
# ─────────────────────────────────────────────────────────────────────────────
domain_name         = "avd.local"     # Fully qualified domain name (FQDN)
dc_private_ip       = "10.0.1.4"      # Static IP for DC (must be in dc_subnet_prefix)
dc_vm_size          = "Standard_B2ms" # DC VM size (minimal spec: B2ms=2vCPU/8GB)
dc_os_disk_type     = "StandardSSD_LRS" # Disk type (StandardSSD_LRS for cost/performance)
dc_os_disk_size_gb  = 128             # OS disk size in GB
dc_enable_public_ip = false           # Public IP disabled by default (use Bastion for management)
avd_ou_name         = "AVD-SessionHosts"  # OU name for session host computer accounts

# ─────────────────────────────────────────────────────────────────────────────
# DEPLOYMENT SIZING - VM counts and sizes
# ─────────────────────────────────────────────────────────────────────────────
session_host_count   = 2                     # Number of session host VMs
session_host_vm_size = "Standard_D4s_v5"     # Session host VM size (D4s_v5=4vCPU/16GB)

# ─────────────────────────────────────────────────────────────────────────────
# AVD CONFIGURATION - Host pool settings
# ─────────────────────────────────────────────────────────────────────────────
hostpool_type            = "Pooled"          # Pooled (shared) or Personal (dedicated)
load_balancer_type       = "BreadthFirst"    # BreadthFirst (spread) or DepthFirst (fill)
maximum_sessions_allowed = 10                # Max concurrent sessions per session host
start_vm_on_connect      = true              # Auto-start deallocated VMs (cost savings)

# ─────────────────────────────────────────────────────────────────────────────
# STORAGE CONFIGURATION - FSLogix profile storage
# ─────────────────────────────────────────────────────────────────────────────
fslogix_share_quota_gb           = 100           # Profile storage size (30-50GB per user)
storage_account_tier             = "Standard"    # Standard (dev) or Premium (prod)
storage_replication_type         = "LRS"         # LRS (cheapest), ZRS, GRS
storage_account_kind             = "StorageV2"   # StorageV2 (Standard) or FileStorage (Premium)
enable_storage_private_endpoint  = false         # Private endpoint (recommended for prod)
enable_ad_authentication_storage = false         # AD DS auth (requires manual setup)

# ─────────────────────────────────────────────────────────────────────────────
# LOGGING & MONITORING - Centralized logging and diagnostics
# ─────────────────────────────────────────────────────────────────────────────
enable_logging               = true   # Enable Log Analytics workspace and diagnostic settings
log_analytics_retention_days = 30     # Log retention: 7-730 days (30 days = ~$15-20/month)
enable_vm_insights           = true   # Install Azure Monitor Agent on DC and session hosts
enable_storage_diagnostics   = true   # Track Azure Files read/write/delete operations
enable_nsg_diagnostics       = true   # Log NSG allowed/denied traffic

# ─────────────────────────────────────────────────────────────────────────────
# BACKUP & DISASTER RECOVERY - Azure Backup configuration
# ─────────────────────────────────────────────────────────────────────────────
enable_backup                = false  # Enable Azure Backup (adds ~$15-134/month depending on config)
vm_backup_retention_days     = 7      # Daily backups retained: 7-9999 days (7 days minimal)
vm_backup_retention_weeks    = 4      # Weekly backups retained: 0-5163 weeks (0=disabled)
backup_time                  = "02:00" # Backup time in HH:MM 24-hour format (off-peak recommended)
fslogix_backup_enabled       = false  # Backup FSLogix profiles (snapshot-based, ~$35/month for 100GB)
backup_session_hosts         = true   # Include session hosts (disable if ephemeral/rebuilable)

# ─────────────────────────────────────────────────────────────────────────────
# UPDATE MANAGEMENT - Automated patching with Azure Update Manager
# ─────────────────────────────────────────────────────────────────────────────
enable_update_management                = false  # Enable automated patching (FREE - no additional cost)
dc_maintenance_start_datetime           = "2026-02-01T02:00:00+00:00"  # DC: First Saturday of month at 2 AM UTC
dc_maintenance_recurrence               = "1Month"                      # DC: Monthly (stable, low-risk)
dc_reboot_setting                       = "IfRequired"                  # DC: Only reboot if necessary
session_host_maintenance_start_datetime = "2026-02-02T03:00:00+00:00"  # Session hosts: Sunday 3 AM (24 hours after DC!)
session_host_maintenance_duration       = "04:00"                       # 4-hour window for rolling updates (prevents simultaneous reboots)
session_host_maintenance_recurrence     = "1Week"                       # Session hosts: Weekly (security best practice)
session_host_reboot_setting             = "IfRequired"                  # Safe with rolling updates
patch_kb_exclusions                     = []                            # Exclude problematic KBs: ["KB5001234"]

# ─────────────────────────────────────────────────────────────────────────────
# COST MANAGEMENT - Budget alerts to prevent cost overruns
# ─────────────────────────────────────────────────────────────────────────────
enable_cost_management     = false   # Enable Azure Budget alerts (FREE - no additional cost)
monthly_budget_amount      = 500     # $500/month budget (adjust based on expected costs + 20% buffer)
budget_alert_emails        = []      # Email recipients: ["ops@company.com", "finance@company.com"]
budget_alert_threshold_1   = 80      # Warning alert at 80% ($400 of $500)
budget_alert_threshold_2   = 90      # Critical alert at 90% ($450 of $500)
budget_alert_threshold_3   = 100     # Exceeded alert at 100% ($500 budget fully consumed)

# ───────────────────────────────────────────────────────────────────────────
# Cost Estimation Guide (Monthly USD)
# ───────────────────────────────────────────────────────────────────────────
# SMALL (Dev/Test):     $280-$520/month  → Set budget: $500-$600
#   - 1 DC (B2ms), 2 session hosts (D4s_v5), 100GB storage
# MEDIUM (Small Prod):  $575-$1110/month → Set budget: $1000-$1200
#   - 1 DC (B4ms), 4 session hosts (D8s_v5), 500GB storage, backup
# LARGE (Production):   $1150-$2220/month → Set budget: $2000-$2500
#   - 2 DCs (D4s_v5 HA), 8 session hosts (D8s_v5), 1TB storage, backup, logs
# ───────────────────────────────────────────────────────────────────────────

# ╔═══════════════════════════════════════════════════════════════════════════╗
# ║ LESS FREQUENTLY CHANGED SETTINGS                                          ║
# ╚═══════════════════════════════════════════════════════════════════════════╝

# ─────────────────────────────────────────────────────────────────────────────
# NETWORKING - Virtual network and subnets
# ─────────────────────────────────────────────────────────────────────────────
vnet_address_space    = "10.0.0.0/16"
dc_subnet_prefix      = "10.0.1.0/24"
avd_subnet_prefix     = "10.0.2.0/24"
storage_subnet_prefix = "10.0.3.0/24"

# ─────────────────────────────────────────────────────────────────────────────
# SESSION HOST IMAGE SOURCE - Choose where session hosts get their OS image
# ─────────────────────────────────────────────────────────────────────────────
# Three image sources supported:
#
# ┌─────────────────────────────────────────────────────────────────────────┐
# │  Image Source Decision Flow                                             │
# ├─────────────────────────────────────────────────────────────────────────┤
# │                                                                          │
# │  1. enable_golden_image = true                                          │
# │     └─→ Uses gallery: golden_image module output                       │
# │                                                                          │
# │  3. session_host_image_source = "marketplace" (default)                 │
# │     └─→ Uses marketplace: marketplace_image_reference                   │
# │                                                                          │
# │  4. session_host_image_source = "gallery"                               │
# │     └─→ Uses gallery: gallery_image_version_id (explicit path)          │
# │                                                                          │
# │  5. session_host_image_source = "managed_image"                         │
# │     └─→ Uses managed_image: managed_image_id                            │
# │                                                                          │
# └─────────────────────────────────────────────────────────────────────────┘

session_host_image_source = "marketplace"  # Change to "gallery" or "managed_image" if needed

# ─────────────────────────────────────────────────────────────────────────────
# OPTION 1: Marketplace Image (session_host_image_source = "marketplace")
# ─────────────────────────────────────────────────────────────────────────────
# Default image configuration - Windows 11 multi-session with Microsoft 365 Apps
# Customize publisher/offer/sku/version as needed:
marketplace_image_reference = {
  publisher = "MicrosoftWindowsDesktop"
  offer     = "windows-11"
  sku       = "win11-22h2-avd"    # Options: win11-22h2-avd, win11-23h2-avd, win10-22h2-avd-m365
  version   = "latest"             # Use "latest" for most recent or specific version like "22621.1.0"
}

# ─────────────────────────────────────────────────────────────────────────────
# OPTION 2: Azure Compute Gallery Image (session_host_image_source = "gallery")
# ─────────────────────────────────────────────────────────────────────────────
# Use this for:
# - Golden Image pipeline output (auto-populated if enable_golden_image = true)
# - Manually imported images in Azure Compute Gallery
# - Images shared from another subscription/gallery
# 
# Example:
# gallery_image_version_id = "/subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/avd-dev-rg/providers/Microsoft.Compute/galleries/avd_dev_gallery/images/avd-golden-image/versions/1.0.0"
# 
# Or use "latest" version:
# gallery_image_version_id = "/subscriptions/.../versions/latest"
# 
# NOTE: If enable_golden_image = true, this is auto-populated from golden_image module output

# ─────────────────────────────────────────────────────────────────────────────
# OPTION 3: Managed Image (session_host_image_source = "managed_image")
# ─────────────────────────────────────────────────────────────────────────────
# Use this for custom images created manually (not recommended for production):
# Example:
# managed_image_id = "/subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/my-images-rg/providers/Microsoft.Compute/images/my-custom-avd-image"

# ─────────────────────────────────────────────────────────────────────────────
# SESSION HOST DISK AND TIMEZONE
# ─────────────────────────────────────────────────────────────────────────────
session_host_os_disk_type = "Premium_LRS"         # Standard_LRS, StandardSSD_LRS, Premium_LRS
timezone                  = "UTC"                 # UTC, Eastern Standard Time, etc.

# ─────────────────────────────────────────────────────────────────────────────
# AVD USER ASSIGNMENT - Azure AD users for AVD access
# ─────────────────────────────────────────────────────────────────────────────
avd_users = [
  # "user1@yourdomain.com",
  # "user2@yourdomain.com",
]

# ─────────────────────────────────────────────────────────────────────────────
# AVD DISPLAY NAMES - Friendly names shown to users
# ─────────────────────────────────────────────────────────────────────────────
workspace_friendly_name      = "Development AVD Workspace"
hostpool_friendly_name       = "Development Host Pool"
app_group_friendly_name      = "Development Desktop"
registration_token_ttl_hours = "48h"

# ─────────────────────────────────────────────────────────────────────────────
# DIAGNOSTICS AND MONITORING
# ─────────────────────────────────────────────────────────────────────────────
enable_diagnostics         = false
log_analytics_workspace_id = ""

# ─────────────────────────────────────────────────────────────────────────────
# RESOURCE TAGS
# ─────────────────────────────────────────────────────────────────────────────
tags = {
  CostCenter  = "IT"
  Owner       = "AVD Team"
  Environment = "Development"
  ManagedBy   = "Terraform"
}

# ============================================================================
# AZURE KEY VAULT INTEGRATION (Recommended for Production)
# ============================================================================
# Instead of storing passwords in terraform.tfvars, use Azure Key Vault:
#
# 1. Store secrets in Key Vault:
#    az keyvault secret set --vault-name "mykeyvault" \
#      --name "domain-admin-password" --value "YourSecurePassword"
#
# 2. Uncomment in main.tf and reference secrets:
#    admin_password = data.azurerm_key_vault_secret.domain_admin_password.value
#
# See main.tf for complete example.
# ============================================================================
